# Partner API

## Typical Use Cases üîÄ

### Working with Orders:
- [Create Order](#create-orders);
- Check the status, usually [via webhook notification](#webhook-order-status-notifications-), although in some cases you can explicitly request to [get orders](#get-orders);
- Sometimes you need to [cancel an order](#cancel-orders) before it enters processing.

### Additional Information:
- [Currency Pairs, Rates, Limits, and Fees](#get-current-currency-pairs-rates-minimummaximum-limits-and-reserves)
- [MineCoin Account Balances](#get-minecoin-balances)

---

## ‚ö°Ô∏è Quick Start (Collection of Methods with Automated Signature in Postman)

For your convenience, we have created a collection in [Postman](https://www.postman.com/) that replicates all API methods. You can test its functionality and experiment with requests.
1. In Postman, select the **Import File** option (for example, on the **Home** tab).
2. Switch to the **Link** tab and import the following URL:  
   `https://api.postman.com/collections/6328473-21626561-38fb-44cd-8c82-e24bc4047d2a?access_key=PMAT-01HT2VGXW98N3BSTC169WZ0HC7`
3. Hover over the imported collection, select the **Variables** tab, and enter your configuration in the **Current Value** column.

## ‚ö†Ô∏è Financial Control

On some currency pairs, orders are recalculated. This means that if an incorrect amount is received from the client, the order is recalculated and executed based on the amount actually received. When receiving the final order status (preferably via webhook), make sure to use the amounts provided in the API response in your system. It is unacceptable to trust the credited amount without verifying the sums.

We also recommend regularly reconciling the balances from our API with those in your system.

## ‚ö†Ô∏è Network Loss Control

Although connections between servers rarely drop, they can occasionally be interrupted. Therefore, you must validate that the data received in response is what you expect:
1. If the request is processed correctly, the client receives a 2xx HTTP code. Otherwise, an error occurred and [the response body contains its details](#standard-error-response-for-all-requests). An alternative check is to verify the `success` parameter in the JSON response (1 if the request was successful, otherwise 0).
2. The API always responds with JSON. If you do not receive valid JSON, you cannot be sure whether your request succeeded or was lost in transit. For critical requests (e.g. payouts), you should verify such requests by any available means and not mark them as completed or failed until you receive a definite confirmation.
    - In some cases, you can send a follow-up API request to check the status. For example, if you made a payout request and are unsure if it went through, you can [check for the existence and status of an order](#get-orders).
    - If automated verification is impossible, please contact technical support. Our support is very responsive, so if you encounter such an exceptional situation, you will receive a reply as quickly as possible üí™

## Security üõ°

Two keys are used for security: the authorization key and the signature key.  
Both keys are generated by the user in the personal account under the **API Settings** tab.

### API Authorization
To authorize with the API, the authorization key must be passed as a header:
```js
Authorization: "Bearer {{AuthKey}}"
```

### API Request Signature
For security purposes, API requests require a signature that hashes the request body using the signature key.  
Pass the generated signature as a header:
```js
X-Signature: "{{Signature}}"
```

The signature itself is generated using the following algorithm:
```php
hmac(sha256(SignatureKey, Request.Body))
```
(Where **SignatureKey** is the signature key and **Request.Body** is the body of the specific request being sent).

If the request body is absent (GET requests), the signature is generated from an empty string.

üì¢ A similar [approach to signing requests](#verifying-the-authenticity-of-webhook-notifications) is used when sending webhook notifications from our side. The only difference is that for API requests from you to us, you generate the signature on your end while we verify it; when sending webhook notifications from us to you, we generate the signature and you verify it.

‚ö°Ô∏è For quick testing, we recommend using [our Postman collection](#%EF%B8%8F-quick-start-collection-of-methods-with-automated-signature-in-postman).

### Allowed IP Addresses

For added security, API method access is allowed only from specific IP addresses (set in your personal account under the **API Settings** tab).

‚ö†Ô∏è You can specify the symbol "**\***" to allow access from all IP addresses, but we **strongly advise against doing this in production**.

---

## Headers for All API Requests
```json
{
    "Accept": "application/json",
    "Content-Type": "application/json",
    "Authorization": "Bearer {{auth_key}}",
    "X-Signature": "{{signature}}"
}
```

## Standard Error Response for All Requests:
```json
{
    "success": 0,
    "code": "4xx-5xx",
    "errors": {
        "message": "{{error_message}}",
        "details": {}
    }
}
```

## Order Object Schema (used in many API requests and responses)
```js
{
    "order_id": "{{Partner System Order ID}}",
    "inbound": {
        "currency": "{{Sending Currency}}",
        "account": "{{Sender Account}}",
        "amount": "{{Sending Amount}}",
        "amount_initial": "{{Initial Sending Amount; Used in API responses}}",
        "txid": "{{Incoming Transaction ID; Used in API responses}}", //nullable
        "code": "{{Payment Code; Used in API requests}}" //nullable        
    },
    "outbound": {
        "currency": "{{Payout Currency}}",
        "account": "{{Recipient Account}}",
        "amount": "{{Payout Amount}}",
        "amount_initial": "{{Initial Payout Amount; Used in API responses}}", 
        "txid": "{{Outgoing Transaction ID; Used in API responses}}", //nullable
        "memo": "{{Cryptocurrency Wallet Memo; Used in API requests}}" //nullable       
    },
    "is_customer_confirmation_need": "{{Flag indicating whether customer confirmation is required; Used in API responses}}",
    "rate": "{{Exchange Rate; Used in API responses}}",
    "rate_initial": "{{Initial Exchange Rate; Used in API responses}}",
    "rate_type": "{{Exchange rate type: inbound|outbound; Used in API responses}}",
    "comment": "{{Order comment (optional)}}",
    "status": "{{Order status: 'new|processing|incoming_unconfirmed|incoming_confirmed|moderation|error|canceled|success'; Used in API responses}}",
    "created_at": "{{Creation time in ISO 8601 format; Used in API responses}}",
    "updated_at": "{{Update time in ISO 8601 format; Used in API responses}}"
}
```

### What is amount_initial?

When [initiating an order](#create-orders) the `amount_initial` is not provided. You must specify either `outbound.amount` or `inbound.amount`, which will immediately be recorded as `amount_initial`.

Reasons why `amount` and `amount_initial` might differ:
- An order was created for CARDUAH ‚Üí BTC for 0.1 BTC. After calculation, it turned out that 100K UAH should be paid, but only 50K was paid; the engine recalculated the order and paid out 0.05 BTC.
- Sometimes minor discrepancies occur due to internal recalculations.

### Possible Values for the status Parameter

| **status**               | **Description** |
|--------------------------|-----------------|
| **new**                  | A new order, placed in the queue and not yet processed. |
| **processing**           | The order is being processed and is awaiting action from the user. |
| **incoming_unconfirmed** | In some cases after payment, the system detects a transaction on the network, but funds have not yet been received‚Äîthus, the order is marked with this status, indicating that it is awaiting incoming payment. |
| **incoming_confirmed**   | The client‚Äôs payment has been confirmed. |
| **moderation**           | The order is under moderation by the service manager. (Rare status.) |
| ‚ùì **error**             | An error occurred with the order. This is a non-final status; contact support for details. |
| üèÅ **canceled**          | The order was canceled (by the user or system). For MineCoin pairs, this status indicates that the order reached a final state, the funds were not sent, and the amount was returned to the MineCoin account. Possible causes include incorrect recipient details, bank limitations, or other reasons. Once this status is received, you may retry the payout. |
| üèÅ **success**           | Funds have been paid out and the order is complete. |

üèÅ ‚Äî Final statuses.

‚ùì **error** ‚Äî An unknown exceptional situation occurred; contact support for further clarification. Do not attempt to resend.

---

### Mandatory Parameters that Supplement Order Information:

#### Order.extra ‚Äî Additional data that the partner could provide when creating an order (used in Requests and Responses)
```js
{
    "extra": {
        "success_url": "{{URL to redirect to after successful payment}}", //nullable
        "failed_url": "{{URL to redirect to after unsuccessful payment}}", //nullable
        "client": {
            "id": "{{User ID in your system}}",
            "email": "{{User‚Äôs email address in your system}}",
            "phone": "{{User‚Äôs phone number in your system}}", //nullable
            "first_name": "{{User‚Äôs first name in your system}}", //nullable
            "last_name": "{{User‚Äôs last name in your system}}", //nullable
            "middle_nanme": "{{User‚Äôs middle name in your system}}", //nullable
            "ip": "{{User‚Äôs IP address when performing the action}}",
            "user_agent": "{{User agent (browser) of the user. For PHP developers: available in $_SERVER['HTTP_USER_AGENT']}}"
        }
    }
}
```

### Optional but Possible Parameters that Supplement Order Information:

#### Order.payment_variants ‚Äî Possible Payment Methods for an Order by the Client (used in Responses)
```js
{
    "payment_variants": {
        "invoice": {
            "url": "{{https://***}}",
            "error": null | "{{Error description}}"
        },
        "direct": {
            "url": "{{https://***}}",
            "error": null | "{{Error description}}"
        },
        "manual": {
            "number": "{{***}}",
            "memo": null | "{{memo}}",
            "error": null | "{{Error description}}"
        }
    }
}
```   

**Payment details in payment_variants vary depending on the receiving payment system**

‚ö†Ô∏è This description is current as of the time of writing and is provided solely for the integrator‚Äôs guidance. The set of parameters may change.

| **Payment System**        | **Object in payment_variants** | **Description** |
|---------------------------|--------------------------------|-----------------|
| **Jumbo**                 | invoice                        | (url) A link to redirect the client to the issued invoice |
| **Payeer**                | direct                         | (url) A link to redirect the client to the direct payment page for the wallet |
| **BITCOIN (BTC)**         | manual                         | (number) The BTC wallet number for payment |
| **Other Merchants**       | direct                         | (url) A link to the merchant‚Äôs payment form |

**Each element in the "payment_variants" object contains the following parameters:**
- **error** (Mandatory. Defaults to null if there is no error. Otherwise, a textual description of the error preventing the use of this payment method.)
- One of the following payment details (mandatory):
  - **url**: the address of the payment system to which the client must be redirected.
  - **number**: details for a manual payment transfer.
- **note** (An optional textual note to assist developers during integration.)

#### Order.details ‚Äî Used in Responses to Supplement the Order with Additional Details

Currently, for payouts from certain payment systems, receipts are generated in `Order.details.payout_receipts`. Clients can download receipts to confirm the payout.
```js
{
    "details": {
        "comment_for_client": "{{comment_for_client}}",
        "payout_receipts": {
            "{{payment_system_transaction_id}}": {
                "pdf": "{{https://************.pdf}}",
                "jpeg": "{{https://************.jpeg}}",
                "amount": {{amount}}
            },
            ...
        },
        ... 
    }
}
```        

---

## API Methods üî¢

### Get Orders

‚ö†Ô∏è We do not recommend using this method frequently to avoid delays. For notifications on order status changes, use the [Webhook Order Status Notifications](#webhook-order-status-notifications-).

**[GET] /{{API_PARTNERS_PREFIX}}/orders?ids={{id1}},{{id2}},...&page={{pages_count}}&per_page={{items_count}}**
- **ids**: A comma-separated list of partner order IDs. You may specify a single order.
- **page**: (Optional) The page number of the list to retrieve.
- **per_page**: The number of items per page.

#### Successful Response (200)
```js
{
    "success": 1,
    "code": 200,
    "data": {
        "total": {{Total number of items in the result set}},
        "per_page": {{Number of items per page}},
        "page": {{Current page}},
        "orders": {
            "{{Partner Order ID}}": {{Order}},
            ...
        }
    }
}
```
‚ÑπÔ∏è See also: [Order Object Schema](#order-object-schema-used-in-many-api-requests-and-responses).

‚ö†Ô∏è If no orders are found matching your query parameters, the `data.orders` field in the response will be an empty object. Therefore, if you use this method to poll for order statuses (which is highly discouraged, though we understand that business needs can vary), you should verify the presence of your orders within the keys of the `data.orders` object.

---

### Create Orders

This request creates orders. After an order is created, to execute it you must [make the payment using the provided payment details](#order-payment-confirmation) given in the response.

**[POST] /{{API_PARTNERS_PREFIX}}/orders**
```js
{
    "orders": [
        {{Order}},
        ...
    ]
}
```
‚ÑπÔ∏è See also: [Order Object Schema](#order-object-schema-used-in-many-api-requests-and-responses).

**Please note:**
1. It is not possible to create an order with the same ID from one partner.
2. When creating orders, the `inbound.account` field in some cases is not mandatory (for example, in MineCoin payouts).
3. You may specify only one of the amounts‚Äîeither the amount to be received or the payout amount (`inbound.amount` or `outbound.amount`). The other amount is calculated automatically based on exchange rates and fees.
4. It is mandatory to include the [extra parameters](#orderextra‚Äîadditional-data-that-the-partner-could-provide-when-creating-an-order-used-in-requests-and-responses) with details about the order and the user in your system.
5. You can add a "comment" field for your convenience; however, the recipient will not see it. This field will be displayed in the order information via the API and in the personal account.

üí° If you have a special case where the order ID does not need to match your system‚Äôs ID, the API can generate a random `{{order_id}}`. To do this, specify it as follows:
```js
{
    "order_id": "auto-uid"
}
```

#### Successful Response (200)
```js
{
    "success": 1,
    "code": 200,
    "data": {
        "invalid": {
            "{{Partner Order ID}}": "{{Error message}}",
            ...
        },
        "created": {
            "{{Partner Order ID}}": {{Order}},
            ...
        }
    }
}
```

---

### Order Payment Confirmation

‚ÑπÔ∏è Orders can only be confirmed when in the "new" status. Confirmation is required if the `is_customer_confirmation_need` flag in the Order object is set to `true`.

**[PUT] /{{API_PARTNERS_PREFIX}}/orders/confirm-by-customer**
```js
{
    "ids": [
        "{{Partner Order ID}}",
        ...
    ]
}
```

#### Successful Response (200)
```js
{
    "success": 1,
    "code": 200,
    "data": {
        "invalid": {
            "{{Partner Order ID}}": "{{Reason for failure to confirm}}",
            ...
        },
        "confirmed": {
            "{{Partner Order ID}}": {{Order}},
            ...
        }
    }
}
```
‚ÑπÔ∏è See also: [Order Object Schema](#order-object-schema-used-in-many-api-requests-and-responses).

---

### Cancel Orders

In critical cases, partners may need to cancel orders that have been created before the payout process starts.

‚ÑπÔ∏è Orders can only be canceled when in the "new" or "processing" statuses. If the payment process has begun, cancellation via this API method is not possible. In such cases, please contact our support team immediately.

**[DELETE] /{{API_PARTNERS_PREFIX}}/orders**
```js
{
    "ids": [
        "{{Partner Order ID}}",
        ...
    ]
}
```

#### Successful Response (200)
```js
{
    "success": 1,
    "code": 200,
    "data": {
        "invalid": {
            "{{Partner Order ID}}": "{{Error message}}",
            ...
        },
        "canceled": {
            "{{Partner Order ID}}": {{Order}},
            ...
        }
    }
}
```
‚ÑπÔ∏è See also: [Order Object Schema](#order-object-schema-used-in-many-api-requests-and-responses).

---

### Get MineCoin Balances

Retrieves the balances of the deposit account in our system (each account is tied to a specific currency).

**[GET] /{{API_PARTNERS_PREFIX}}/balances**

#### Successful Response (200)
```js
{
    "success": 1,
    "code": 200,
    "data": {
        "BTC": {{Balance Amount}},
        "USDT": {{Balance Amount}},
        "UAH": {{Balance Amount}}        
    }
}
```

---

### Get Current Currency Pairs, Rates, Minimum/Maximum Limits, and Reserves

**[GET] /{{API_PARTNERS_PREFIX}}/pairs?names={{CurrencyA}}:{{CurrencyB}},{{CurrencyX}}:{{CurrencyY}},...&inbound_currencies={{CurrencyA}},{{CurrencyB}}...&outbound_currencies={{CurrencyA}},{{CurrencyB}}**
- **names**: (Optional) A comma-separated list of pairs in the format: `"{{CurrencyA}}:{{CurrencyB}}"`;
- **inbound_currencies**: (Optional) A comma-separated list of inbound currency codes;
- **outbound_currencies**: (Optional) A comma-separated list of outbound currency codes;

#### Successful Response (200)
```js
{
    "success": 1,
    "code": 200,
    "data": {
        "{{CurrencyA}}:{{CurrencyB}}": {
            "inbound": {
                "currency": "CurrencyA",
                "rate": {{Exchange rate of CurrencyA relative to CurrencyB. Typically one of the rates is 1 and the other is a fraction}},
                "is_account_required": {{Indicates whether the account field is required when creating an order}}
            },
            "outbound": {
                "currency": "CurrencyB",
                "rate": {{Exchange rate of CurrencyB relative to CurrencyA. Typically one of the rates is 1 and the other is a fraction}},
                "is_account_required": {{Indicates whether the account field is required when creating an order}}
            },
            "rate": {{Combined exchange rate for the currency pair}},
            "min_amount": {{Minimum available amount of the first currency for processing}},
            "max_amount": "{{Maximum available amount of the first currency for processing}}",
            "reserve": {{Available reserve amount for the payout currency}}
        },
        ...
    }
}
```

---

## Webhook Order Status Notifications üì¢

You can (and we strongly recommend you) subscribe a URL on your server for notifications on order status changes.

The "***{{Callback URL}}***" is specified in your personal account under the **API Settings** tab.  
When an order‚Äôs status changes, the system will send an HTTP **POST** request to your "***{{Callback URL}}***" with a request body containing the **[Order](#order-object-schema-used-in-many-api-requests-and-responses)** object.

Your server must respond with a **2XX** status code. If it does not, the webhook will be retried after a delay. With each subsequent failure, the delay increases and the webhook is retried. At the time of writing, up to 10 retry attempts are allowed, though this may change without notice.

üí° To test webhooks, you can use the excellent third-party tool [webhook.site](https://webhook.site), which provides a URL for receiving notifications and allows you to monitor them via your browser.

### Verifying the Authenticity of Webhook Notifications

For security purposes (to ensure that the webhook was sent by an official source), webhook notifications include a signature that hashes the request body using the signature key.

You can (and we strongly recommend you) verify the signature on your end by comparing the signature received in the header (`X-Signature`) with the one generated on your side.

The signature is generated automatically using the exact same algorithm as in the [API Request Signature](#api-request-signature).
